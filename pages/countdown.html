<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¢å¼ºç‰ˆå€’è®¡æ—¶</title>
  <style>
    html,
    body,
    h2,
    p {
      margin: 0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #FFFFFF; /* èƒŒæ™¯æ”¹ä¸ºç™½è‰² */
      min-height: 100vh;
      padding: 20px;
      box-sizing: border-box;
    }

    .main-container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      color: #333; /* ä¿®æ”¹æ ‡é¢˜é¢œè‰²ä¸ºæ·±è‰² */
      font-size: 2.5em;
      margin-bottom: 10px;
      text-shadow: none; /* ç§»é™¤æ–‡å­—é˜´å½± */
    }

    .header p {
      color: #666; /* ä¿®æ”¹å‰¯æ ‡é¢˜é¢œè‰²ä¸ºç°è‰² */
      font-size: 1.1em;
    }

    .countdown-grid {
      display: flex; /* æ”¹ä¸º flex å¸ƒå±€ */
      flex-wrap: wrap; /* å…è®¸æ¢è¡Œ */
      justify-content: center; /* å±…ä¸­å¯¹é½ */
      gap: 20px;
      margin-bottom: 30px;
    }

    .container {
      border-radius: 20px;
      padding: 15px;
      position: relative;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
      background-color: #f0f0f0; /* å®¹å™¨èƒŒæ™¯è‰² */
    }

    .container:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0,0,0,0.2);
    }

    .matter {
      text-align: center;
      width: 100%;
      color: #FFFFFF; /* ç¡®ä¿æ–‡æœ¬ä¸ºç™½è‰² */
      border-radius: 15px;
      padding: 20px 0;
      position: relative;
      background: rgba(0, 0, 0, 0.3); /* æ›´æ·±çš„èƒŒæ™¯ï¼Œæé«˜å¯è¯»æ€§ */
      backdrop-filter: blur(5px); /* ç¨å¾®å‡å¼±æ¨¡ç³Šæ•ˆæœ */
      cursor: pointer;
    }

    .matter.passed {
      background: rgba(0, 0, 0, 0.15); /* å·²è¿‡æœŸå€’è®¡æ—¶èƒŒæ™¯æ›´æ·± */
      opacity: 0.8;
    }

    .days {
      font-size: 2.5em;
      font-weight: bold;
      margin: 10px 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .time-detail {
      padding: 15px 20px;
      color: rgba(255,255,255,0.9);
      text-align: center;
      font-size: 1.1em;
    }

    .current-time {
      font-size: 2.5em;
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }

    .mark {
      position: absolute;
      bottom: 10px;
      right: 15px;
      font-size: 12px;
      opacity: 0.3;
      color: white;
    }

    /* æ§åˆ¶æŒ‰é’®ç»„ */
    .control-buttons {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 100;
    }

    .control-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: linear-gradient(135deg, #002FA7 0%, #0047AB 100%); /* æ§åˆ¶æŒ‰é’®èƒŒæ™¯ä¸ä¸»é¢˜ä¸€è‡´ */
      color: white;
      border: none;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      font-size: 24px;
    }

    .control-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 25px rgba(0,0,0,0.4);
    }

    /* è®¾ç½®é¢æ¿æ ·å¼ */
    .settings-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0);
      justify-content: center;
      align-items: center;
      z-index: 200;
      transition: background-color 0.3s ease;
    }

    .settings-modal.show {
      background-color: rgba(0,0,0,0.7);
    }

    .settings {
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      padding: 30px;
      background: rgba(255, 255, 255, 0.9); /* è®¾ç½®é¢æ¿èƒŒæ™¯æ›´äº® */
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      transform: scale(0.8);
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }

    .settings.show {
      transform: scale(1);
      opacity: 1;
    }

    .settings h3 {
      margin-top: 0;
      color: #333;
      margin-bottom: 25px;
      font-size: 1.8em;
      text-align: center;
    }

    .input-group {
      margin-bottom: 20px;
    }

    .input-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #333;
      font-size: 1.1em;
    }

    .input-group input,
    .input-group select {
      width: 100%;
      padding: 12px;
      border: 2px solid #ccc; /* è¾¹æ¡†é¢œè‰² */
      border-radius: 10px;
      box-sizing: border-box;
      font-size: 1em;
      transition: border-color 0.3s ease;
    }

    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: #002FA7; /* ç„¦ç‚¹è¾¹æ¡†é¢œè‰² */
    }

    .color-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 10px;
    }

    .color-option {
      width: 100%;
      height: 50px;
      border: 3px solid transparent;
      border-radius: 10px;
      cursor: pointer;
      transition: border-color 0.3s ease, transform 0.3s ease;
    }

    .color-option.selected {
      border-color: #333;
      transform: scale(1.1);
    }

    .size-options {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .size-option {
      flex: 1;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 10px;
      background: white;
      cursor: pointer;
      text-align: center;
      transition: all 0.3s ease;
    }

    .size-option.selected {
      border-color: #002FA7; /* å°ºå¯¸é€‰æ‹©å™¨é€‰ä¸­çŠ¶æ€è¾¹æ¡†é¢œè‰² */
      background: #002FA7; /* å°ºå¯¸é€‰æ‹©å™¨é€‰ä¸­çŠ¶æ€èƒŒæ™¯é¢œè‰² */
      color: white;
    }

    .btn-group {
      display: flex;
      gap: 15px;
      margin-top: 30px;
    }

    .btn {
      flex: 1;
      padding: 15px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1.1em;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #002FA7 0%, #0047AB 100%); /* æŒ‰é’®èƒŒæ™¯ä¸ä¸»é¢˜ä¸€è‡´ */
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 47, 167, 0.4);
    }

    .btn-secondary {
      background: #f8f9fa;
      color: #333;
      border: 2px solid #ddd;
    }

    .btn-secondary:hover {
      background: #e9ecef;
    }

    /* æç¤ºæ¡†æ ·å¼ */
    .toast {
      position: fixed;
      top: -80px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #002FA7 0%, #0047AB 100%); /* æç¤ºæ¡†èƒŒæ™¯ä¸ä¸»é¢˜ä¸€è‡´ */
      color: white;
      padding: 15px 30px;
      border-radius: 15px;
      font-weight: bold;
      z-index: 300;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      transition: top 0.3s ease;
      font-size: 1.1em;
    }

    .toast.show {
      top: 30px;
    }

    /* ç©ºçŠ¶æ€æ ·å¼ */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #666; /* ä¿®æ”¹ç©ºçŠ¶æ€æ–‡å­—é¢œè‰² */
    }

    .empty-state h3 {
      font-size: 2em;
      margin-bottom: 15px;
    }

    .empty-state p {
      font-size: 1.2em;
      margin-bottom: 30px;
    }

    .empty-state button {
      padding: 15px 30px;
      font-size: 1.2em;
      background: linear-gradient(135deg, #002FA7 0%, #0047AB 100%); /* ç©ºçŠ¶æ€æŒ‰é’®èƒŒæ™¯ä¸ä¸»é¢˜ä¸€è‡´ */
      color: white;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    .empty-state button:hover {
      transform: scale(1.05);
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
      .countdown-grid {
        grid-template-columns: 1fr;
      }
      
      .header h1 {
        font-size: 2em;
      }
      
      .control-buttons {
        bottom: 15px;
        right: 15px;
      }
      
      .control-btn {
        width: 50px;
        height: 50px;
        font-size: 20px;
      }
      
      .settings {
        width: 95%;
        padding: 20px;
      }
    }

    /* ä¸»é¢˜è‰²å½©å˜é‡ */
    .theme-blue { background: linear-gradient(135deg, #002FA7 0%, #0047AB 100%); }
    .theme-green { background: linear-gradient(135deg, #28a745 0%, #218838 100%); }
    .theme-red { background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); }
    .theme-purple { background: linear-gradient(135deg, #6f42c1 0%, #5a32a3 100%); }
    .theme-orange { background: linear-gradient(135deg, #fd7e14 0%, #e66a00 100%); }
    .theme-pink { background: linear-gradient(135deg, #e83e8c 0%, #d6267a 100%); }
    .theme-teal { background: linear-gradient(135deg, #20c997 0%, #17a2b8 100%); }
    .theme-dark { background: linear-gradient(135deg, #343a40 0%, #23272b 100%); }

    /* å°ºå¯¸å˜é‡ */
    .size-small .container { transform: scale(0.8); }
    .size-medium .container { transform: scale(1); }
    .size-large .container { transform: scale(1.2); }
  </style>
</head>

<body>
  <div class="main-container">
    <div class="header">
      <h1>ğŸ• å¢å¼ºç‰ˆå€’è®¡æ—¶</h1>
      <p>ç®¡ç†æ‚¨çš„é‡è¦æ—¶åˆ»ï¼Œæ”¯æŒå¤šå€’è®¡æ—¶ã€è‡ªå®šä¹‰é…è‰²å’Œç²¾åº¦è®¾ç½®</p>
    </div>

    <div id="countdown-container" class="countdown-grid">
      </div>

    <div id="empty-state" class="empty-state" style="display: none;">
      <h3>ğŸ¯ è¿˜æ²¡æœ‰å€’è®¡æ—¶</h3>
      <p>ç‚¹å‡»ä¸‹æ–¹çš„ + æŒ‰é’®æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä¸ªå€’è®¡æ—¶</p>
      <button onclick="openSettings()">ç«‹å³æ·»åŠ </button>
    </div>
  </div>

  <div class="control-buttons">
    <button class="control-btn" onclick="openSettings()" title="æ·»åŠ å€’è®¡æ—¶">
      â•
    </button>
    <button class="control-btn" onclick="openGlobalSettings()" title="å…¨å±€è®¾ç½®">
      âš™ï¸
    </button>
  </div>

  <div class="settings-modal" id="settings-modal">
    <div class="settings" id="settings-panel">
      <h3 id="modal-title">æ·»åŠ å€’è®¡æ—¶</h3>
      
      <div class="input-group">
        <label for="title-input">æ ‡é¢˜:</label>
        <input type="text" id="title-input" placeholder="ä¾‹å¦‚ï¼šæ˜¥èŠ‚ã€ç”Ÿæ—¥ã€è€ƒè¯•..." maxlength="20">
      </div>
      
      <div class="input-group">
        <label for="date-input">ç›®æ ‡æ—¥æœŸ:</label>
        <input type="datetime-local" id="date-input">
      </div>
      
      <div class="input-group">
        <label for="description-input">æè¿° (å¯é€‰):</label>
        <input type="text" id="description-input" placeholder="æ·»åŠ ä¸€äº›æè¿°..." maxlength="50">
      </div>
      
      <div class="input-group">
        <label>é€‰æ‹©ä¸»é¢˜è‰²å½©:</label>
        <div class="color-grid">
          <div class="color-option theme-blue selected" data-theme="blue"></div>
          <div class="color-option theme-green" data-theme="green"></div>
          <div class="color-option theme-red" data-theme="red"></div>
          <div class="color-option theme-purple" data-theme="purple"></div>
          <div class="color-option theme-orange" data-theme="orange"></div>
          <div class="color-option theme-pink" data-theme="pink"></div>
          <div class="color-option theme-teal" data-theme="teal"></div>
          <div class="color-option theme-dark" data-theme="dark"></div>
        </div>
      </div>
      
      <div class="input-group">
        <label for="precision-select">æ—¶é—´æ˜¾ç¤ºç²¾åº¦:</label>
        <select id="precision-select">
          <option value="seconds">ç²¾ç¡®åˆ°ç§’</option>
          <option value="minutes">ç²¾ç¡®åˆ°åˆ†é’Ÿ</option>
          <option value="hours">ç²¾ç¡®åˆ°å°æ—¶</option>
          <option value="days">ä»…æ˜¾ç¤ºå¤©æ•°</option>
        </select>
      </div>
      
      <div class="btn-group">
        <button class="btn btn-secondary" onclick="closeSettings()">å–æ¶ˆ</button>
        <button class="btn btn-primary" onclick="saveCountdown()">ä¿å­˜</button>
        <button class="btn btn-secondary" id="delete-countdown-btn" style="display: none;">åˆ é™¤</button>
        <button class="btn btn-secondary" id="embed-countdown-btn" style="display: none;">åµŒå…¥</button>
      </div>
    </div>
  </div>

  <div class="settings-modal" id="global-settings-modal">
    <div class="settings" id="global-settings-panel">
      <h3>å…¨å±€è®¾ç½®</h3>
      
      <div class="input-group">
        <label>æ˜¾ç¤ºå¤§å°:</label>
        <div class="size-options">
          <div class="size-option" data-size="small">å°</div>
          <div class="size-option selected" data-size="medium">ä¸­</div>
          <div class="size-option" data-size="large">å¤§</div>
        </div>
      </div>
      
      <div class="input-group">
        <label for="auto-refresh">è‡ªåŠ¨åˆ·æ–°é—´éš”:</label>
        <select id="auto-refresh">
          <option value="1000">1ç§’</option>
          <option value="5000">5ç§’</option>
          <option value="10000">10ç§’</option>
          <option value="60000">1åˆ†é’Ÿ</option>
        </select>
      </div>
      
      <div class="btn-group">
        <button class="btn btn-secondary" onclick="closeGlobalSettings()">å–æ¶ˆ</button>
        <button class="btn btn-primary" onclick="saveGlobalSettings()">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast-message">æ“ä½œæˆåŠŸ</div>

  <script>
    // å…¨å±€å˜é‡
    let countdowns = [];
    let currentEditingId = null;
    let globalSettings = {
      size: 'medium',
      refreshInterval: 1000
    };
    let refreshTimer = null;

    // åˆå§‹åŒ–åº”ç”¨
    function initApp() {
      const urlParams = new URLSearchParams(window.location.search);
      const isEmbedded = urlParams.get("embedded") === "true";

      if (isEmbedded) {
        // åµŒå…¥æ¨¡å¼
        document.querySelector(".control-buttons").style.display = "none";
        document.querySelector(".header").style.display = "none";
        const countdownData = {
          id: "embedded",
          title: urlParams.get("title") || "",
          targetDate: urlParams.get("targetDate") || "",
          description: urlParams.get("description") || "",
          precision: urlParams.get("precision") || "seconds",
          theme: urlParams.get("theme") || "blue",
          passed: false,
        };
        countdowns = [countdownData];
        updateCountdownData(countdownData);
        renderCountdowns(true); // åµŒå…¥æ¨¡å¼ä¸‹ä¸æ·»åŠ ç‚¹å‡»äº‹ä»¶
        startAutoRefresh();
      } else {
        // æ­£å¸¸æ¨¡å¼
        loadCountdowns();
        loadGlobalSettings();
        setupEventListeners();
        startAutoRefresh();
        renderCountdowns();
      }
    }

    // åŠ è½½å€’è®¡æ—¶æ•°æ®
    function loadCountdowns() {
      const saved = localStorage.getItem("enhanced-countdowns");
      if (saved) {
        countdowns = JSON.parse(saved);
      }
    }

    // ä¿å­˜å€’è®¡æ—¶æ•°æ®
    function saveCountdowns() {
      localStorage.setItem("enhanced-countdowns", JSON.stringify(countdowns));
    }

    // åŠ è½½å…¨å±€è®¾ç½®
    function loadGlobalSettings() {
      const saved = localStorage.getItem("global-settings");
      if (saved) {
        globalSettings = { ...globalSettings, ...JSON.parse(saved) };
      }
      
      // åº”ç”¨å…¨å±€è®¾ç½®
      document.body.className = `size-${globalSettings.size}`;
      document.getElementById("auto-refresh").value = globalSettings.refreshInterval;
      
      // æ›´æ–°å°ºå¯¸é€‰æ‹©å™¨
      document.querySelectorAll(".size-option").forEach(option => {
        option.classList.toggle("selected", option.dataset.size === globalSettings.size);
      });
    }

    // ä¿å­˜å…¨å±€è®¾ç½®
    function saveGlobalSettingsData() {
      localStorage.setItem('global-settings', JSON.stringify(globalSettings));
    }

    // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
    function setupEventListeners() {
      // é¢œè‰²é€‰æ‹©
      document.querySelectorAll('.color-option').forEach(option => {
        option.addEventListener('click', function() {
          document.querySelectorAll('.color-option').forEach(o => o.classList.remove('selected'));
          this.classList.add('selected');
        });
      });

      // å°ºå¯¸é€‰æ‹©
      document.querySelectorAll('.size-option').forEach(option => {
        option.addEventListener('click', function() {
          document.querySelectorAll('.size-option').forEach(o => o.classList.remove('selected'));
          this.classList.add('selected');
        });
      });

      // åˆ é™¤æŒ‰é’®äº‹ä»¶
      document.getElementById('delete-countdown-btn').addEventListener('click', function() {
        if (currentEditingId && confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå€’è®¡æ—¶å—ï¼Ÿ')) {
          countdowns = countdowns.filter(c => c.id !== currentEditingId);
          saveCountdowns();
          renderCountdowns();
          closeSettings();
          showToast('å€’è®¡æ—¶å·²åˆ é™¤');
        }
      });

      // åµŒå…¥æŒ‰é’®äº‹ä»¶
      document.getElementById('embed-countdown-btn').addEventListener('click', function() {
        if (currentEditingId) {
          const countdown = countdowns.find(c => c.id === currentEditingId);
          if (countdown) {
            const embedUrl = `${window.location.origin}${window.location.pathname}?embedded=true&title=${encodeURIComponent(countdown.title)}&targetDate=${encodeURIComponent(countdown.targetDate)}&description=${encodeURIComponent(countdown.description || '')}&precision=${countdown.precision}&theme=${countdown.theme}`;
            
            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            navigator.clipboard.writeText(embedUrl).then(() => {
              showToast('åµŒå…¥é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }).catch(() => {
              showToast('æ— æ³•å¤åˆ¶é“¾æ¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            });
            
            // åœ¨æ–°æ ‡ç­¾é¡µæ‰“å¼€
            window.open(embedUrl, '_blank');
          }
        }
      });

      // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
      document.getElementById('settings-modal').addEventListener('click', function(e) {
        if (e.target === this) closeSettings();
      });

      document.getElementById('global-settings-modal').addEventListener('click', function(e) {
        if (e.target === this) closeGlobalSettings();
      });
    }

    // å¼€å§‹è‡ªåŠ¨åˆ·æ–°
    function startAutoRefresh() {
      if (refreshTimer) clearInterval(refreshTimer);
      refreshTimer = setInterval(updateAllCountdowns, globalSettings.refreshInterval);
    }

    // æ¸²æŸ“æ‰€æœ‰å€’è®¡æ—¶
    function renderCountdowns(isEmbedded = false) {
      const container = document.getElementById("countdown-container");
      const emptyState = document.getElementById("empty-state");

      if (countdowns.length === 0) {
        container.style.display = "none";
        emptyState.style.display = "block";
        return;
      }

      container.style.display = "flex"; // Ensure it's flex
      emptyState.style.display = "none";

      container.innerHTML = countdowns.map((countdown) => `
        <div class="container theme-${countdown.theme}" data-id="${countdown.id}">
          <div class="matter ${countdown.passed ? 'passed' : ''}" ${isEmbedded ? '' : `onclick="editCountdown('${countdown.id}')"`}>
            <p class="title">${countdown.title}${countdown.passed ? "å·²ç»“æŸ" : "è¿˜å‰©"}</p>
            <h2 class="days">${countdown.daysText}</h2>
            <p class="other">${countdown.timeText}</p>
            ${countdown.description ? `<p class="description" style="font-size: 0.9em; opacity: 0.8; margin-top: 10px;">${countdown.description}</p>` : ``}
          </div>
          <div class="time-detail">
            <span class="current-time">${getCurrentTime()}</span>
            <p class="current-date">${getCurrentDate()}</p>
          </div>
          <p class="mark">Enhanced</p>
        </div>
      `).join("");
    }

    // æ›´æ–°æ‰€æœ‰å€’è®¡æ—¶
    function updateAllCountdowns() {
      const urlParams = new URLSearchParams(window.location.search);
      const isEmbedded = urlParams.get("embedded") === "true";
      
      countdowns.forEach(countdown => {
        updateCountdownData(countdown);
      });
      renderCountdowns(isEmbedded);
    }

    // æ›´æ–°å•ä¸ªå€’è®¡æ—¶æ•°æ®
    function updateCountdownData(countdown) {
      const now = new Date();
      const target = new Date(countdown.targetDate);
      const diff = target.getTime() - now.getTime();
      
      countdown.passed = diff <= 0;
      const absDiff = Math.abs(diff) / 1000;
      
      const days = Math.floor(absDiff / (24 * 60 * 60));
      const hours = Math.floor((absDiff % (24 * 60 * 60)) / (60 * 60));
      const minutes = Math.floor((absDiff % (60 * 60)) / 60);
      const seconds = Math.floor(absDiff % 60);
      
      // æ ¹æ®ç²¾åº¦è®¾ç½®æ˜¾ç¤ºæ–‡æœ¬
      switch (countdown.precision) {
        case 'days':
          countdown.daysText = days === 0 ? 'D-DAY' : `${days}å¤©`;
          countdown.timeText = '';
          break;
        case 'hours':
          countdown.daysText = days === 0 ? 'D-DAY' : `${days}å¤©`;
          countdown.timeText = `${String(hours).padStart(2, '0')}æ—¶`;
          break;
        case 'minutes':
          countdown.daysText = days === 0 ? 'D-DAY' : `${days}å¤©`;
          countdown.timeText = `${String(hours).padStart(2, '0')}æ—¶${String(minutes).padStart(2, '0')}åˆ†`;
          break;
        case 'seconds':
        default:
          countdown.daysText = days === 0 ? 'D-DAY' : `${days}å¤©`;
          countdown.timeText = `${String(hours).padStart(2, '0')}æ—¶${String(minutes).padStart(2, '0')}åˆ†${String(seconds).padStart(2, '0')}ç§’`;
          break;
      }
    }

    // è·å–å½“å‰æ—¶é—´
    function getCurrentTime() {
      const now = new Date();
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      return `${hours}:${minutes}`;
    }

    // è·å–å½“å‰æ—¥æœŸ
    function getCurrentDate() {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    // æ‰“å¼€è®¾ç½®é¢æ¿
    function openSettings(id = null) {
      currentEditingId = id;
      const modal = document.getElementById('settings-modal');
      const panel = document.getElementById('settings-panel');
      const title = document.getElementById('modal-title');
      const deleteBtn = document.getElementById('delete-countdown-btn');
      const embedBtn = document.getElementById('embed-countdown-btn');

      if (id) {
        // ç¼–è¾‘æ¨¡å¼
        const countdown = countdowns.find(c => c.id === id);
        if (countdown) {
          title.textContent = 'ç¼–è¾‘å€’è®¡æ—¶';
          document.getElementById('title-input').value = countdown.title;
          document.getElementById('date-input').value = countdown.targetDate;
          document.getElementById('description-input').value = countdown.description || '';
          document.getElementById('precision-select').value = countdown.precision;
          
          // è®¾ç½®ä¸»é¢˜è‰²å½©
          document.querySelectorAll('.color-option').forEach(option => {
            option.classList.toggle('selected', option.dataset.theme === countdown.theme);
          });
          
          deleteBtn.style.display = 'block';
          embedBtn.style.display = 'block';
        }
      } else {
        // æ·»åŠ æ¨¡å¼
        title.textContent = 'æ·»åŠ å€’è®¡æ—¶';
        document.getElementById('title-input').value = '';
        document.getElementById('date-input').value = '';
        document.getElementById('description-input').value = '';
        document.getElementById('precision-select').value = 'seconds';
        
        // é‡ç½®ä¸»é¢˜è‰²å½©é€‰æ‹©
        document.querySelectorAll('.color-option').forEach(option => {
          option.classList.toggle('selected', option.dataset.theme === 'blue');
        });
        
        deleteBtn.style.display = 'none';
        embedBtn.style.display = 'none';
      }

      modal.style.display = 'flex';
      setTimeout(() => {
        modal.classList.add('show');
        panel.classList.add('show');
      }, 10);
    }

    // å…³é—­è®¾ç½®é¢æ¿
    function closeSettings() {
      const modal = document.getElementById('settings-modal');
      const panel = document.getElementById('settings-panel');
      
      modal.classList.remove('show');
      panel.classList.remove('show');
      
      setTimeout(() => {
        modal.style.display = 'none';
        currentEditingId = null;
      }, 300);
    }

    // ä¿å­˜å€’è®¡æ—¶
    function saveCountdown() {
      const title = document.getElementById('title-input').value.trim();
      const targetDate = document.getElementById('date-input').value;
      const description = document.getElementById('description-input').value.trim();
      const precision = document.getElementById('precision-select').value;
      const selectedTheme = document.querySelector('.color-option.selected').dataset.theme;

      if (!title || !targetDate) {
        showToast('è¯·å¡«å†™æ ‡é¢˜å’Œç›®æ ‡æ—¥æœŸ', 'error');
        return;
      }

      const countdownData = {
        id: currentEditingId || Date.now().toString(),
        title,
        targetDate,
        description,
        precision,
        theme: selectedTheme,
        passed: false
      };

      if (currentEditingId) {
        // ç¼–è¾‘ç°æœ‰å€’è®¡æ—¶
        const index = countdowns.findIndex(c => c.id === currentEditingId);
        if (index !== -1) {
          countdowns[index] = countdownData;
        }
      } else {
        // æ·»åŠ æ–°å€’è®¡æ—¶
        countdowns.push(countdownData);
      }
      updateCountdownData(countdownData);
      saveCountdowns();
      renderCountdowns();
      closeSettings();
      showToast(currentEditingId ? 'å€’è®¡æ—¶å·²æ›´æ–°' : 'å€’è®¡æ—¶å·²æ·»åŠ ');
    }

    // ç¼–è¾‘å€’è®¡æ—¶
    function editCountdown(id) {
      openSettings(id);
    }

    // æ‰“å¼€å…¨å±€è®¾ç½®
    function openGlobalSettings() {
      const modal = document.getElementById('global-settings-modal');
      const panel = document.getElementById('global-settings-panel');

      modal.style.display = 'flex';
      setTimeout(() => {
        modal.classList.add('show');
        panel.classList.add('show');
      }, 10);
    }

    // å…³é—­å…¨å±€è®¾ç½®
    function closeGlobalSettings() {
      const modal = document.getElementById('global-settings-modal');
      const panel = document.getElementById('global-settings-panel');
      
      modal.classList.remove('show');
      panel.classList.remove('show');
      
      setTimeout(() => {
        modal.style.display = 'none';
      }, 300);
    }

    // ä¿å­˜å…¨å±€è®¾ç½®
    function saveGlobalSettings() {
      const selectedSize = document.querySelector('.size-option.selected').dataset.size;
      const refreshInterval = parseInt(document.getElementById('auto-refresh').value);

      globalSettings.size = selectedSize;
      globalSettings.refreshInterval = refreshInterval;

      // åº”ç”¨è®¾ç½®
      document.body.className = `size-${selectedSize}`;
      
      saveGlobalSettingsData();
      startAutoRefresh();
      closeGlobalSettings();
      showToast('å…¨å±€è®¾ç½®å·²ä¿å­˜');
    }

    // æ˜¾ç¤ºæç¤ºæ¡†
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast-message');
      toast.textContent = message;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>
```
